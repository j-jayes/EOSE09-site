<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jonathan Jayes">
<meta name="dcterms.date" content="2023-02-28">

<title> - Q and A</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title"><i class="fa-solid fa-map" aria-label="map"></i></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">EOSE09 - Economy and Society: Regional Development and Growth</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#purpose" id="toc-purpose" class="nav-link active" data-scroll-target="#purpose">Purpose</a></li>
  <li><a href="#choose-specific-colours-for-choropleth" id="toc-choose-specific-colours-for-choropleth" class="nav-link" data-scroll-target="#choose-specific-colours-for-choropleth">Choose specific colours for choropleth</a></li>
  <li><a href="#morans-i" id="toc-morans-i" class="nav-link" data-scroll-target="#morans-i">Moran’s I</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Q and A</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jonathan Jayes </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 28, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="purpose" class="level2">
<h2 class="anchored" data-anchor-id="purpose">Purpose</h2>
<p>In the article below I share the help that I provided to students who asked about manual colour palettes in Stata and how to calculate Moran’s I in Stata, a measure of spatial autocorrelation.</p>
</section>
<section id="choose-specific-colours-for-choropleth" class="level2">
<h2 class="anchored" data-anchor-id="choose-specific-colours-for-choropleth">Choose specific colours for choropleth</h2>
<p>Q: Could you help me with the code and command I need to use in Stata to change the color of a specific region in a choropleth map?</p>
<p>A: Sure! We can choose our own colours for a palette with their RGB codes</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
RGB colour codes
</div>
</div>
<div class="callout-body-container callout-body">
<p>What are RGB Color Codes?</p>
<p>RGB color codes are a set of numerical values used to specify colors in digital devices such as computers, televisions, and smartphones. RGB stands for red, green, and blue, which are the primary colors used in digital displays. Each color is represented by a value between 0 and 255, with 0 indicating no intensity and 255 indicating maximum intensity.</p>
<p>Using RGB Color Codes</p>
<p>RGB color codes are commonly used to specify different types of colors, including those used in web design, graphic design, and data visualization. For example, the color “midnightblue” can be represented by the hex code 191970 or the RGB values (25, 25, 112). In this case, the first two digits of the hex code represent the intensity of red, the second two digits represent green, and the last two digits represent blue. Similarly, the RGB values represent the intensity of red, green, and blue, respectively.</p>
<p>In data visualization, RGB color codes are often used to create choropleth maps that display different colors based on the value of a particular variable in a specific region. By using RGB color codes, users can create maps that are visually appealing and easy to interpret.</p>
</div>
</div>
<p>First you can choose your colours by Googling a colour that you like and copying across it’s rgb code:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lab-Q-and-A-resources/google-colours.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Google colours</figcaption>
</figure>
</div>
<p>In this case we want three colours for three different groups. Let’s choose some from the <a href="https://www.reed.edu/economics/parker/311/Creating-Color-Blind-Accessible-Figures-ProfHacker---Blogs---The-Chronicle-of-Higher-Education.pdf">Okabe-Ito palette</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lab-Q-and-A_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Okabe-Ito colours</figcaption>
</figure>
</div>
</div>
</div>
<p>Next in Stata we import the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>clear all</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>set more off</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>use regional_dataset, clear</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we create some groups</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># manual legends</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>keep <span class="cf">if</span> country <span class="sc">==</span> <span class="st">"France"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set groups</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>gen groups <span class="ot">=</span> .</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>replace groups <span class="ot">=</span> <span class="dv">1</span> <span class="cf">if</span> region <span class="sc">==</span> <span class="st">"Alsace"</span> <span class="sc">|</span>  region <span class="sc">==</span> <span class="st">"Champagne-Ardenne"</span> <span class="sc">|</span> <span class="er">///</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">==</span> <span class="st">"Bretagne"</span> <span class="sc">|</span> <span class="er">///</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">==</span> <span class="st">"Franche-Comté"</span> <span class="sc">|</span> region <span class="sc">==</span> <span class="st">"Languedoc-Roussillon"</span> <span class="sc">|</span> <span class="er">///</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">==</span> <span class="st">"Lorraine"</span> <span class="sc">|</span> region <span class="sc">==</span> <span class="st">"Midi-Pyrénées"</span> <span class="sc">|</span> region <span class="sc">==</span> <span class="st">"Nord - Pas-de-Calais"</span> <span class="sc">|</span> <span class="er">///</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">==</span> <span class="st">"Provence-Alpes-Côte d'Azur"</span> <span class="sc">|</span> region <span class="sc">==</span> <span class="st">"Corse"</span> <span class="sc">|</span> region <span class="sc">==</span> <span class="st">"Picardie"</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>replace groups <span class="ot">=</span> <span class="dv">2</span> <span class="cf">if</span> region <span class="sc">==</span> <span class="st">"Aquitaine"</span> <span class="sc">|</span> region <span class="sc">==</span> <span class="st">"Auvergne"</span> <span class="sc">|</span> region <span class="sc">==</span> <span class="st">"Basse-Normandie"</span> <span class="sc">|</span> <span class="er">///</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">==</span> <span class="st">"Bourgogne"</span> <span class="sc">|</span> <span class="er">///</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">==</span> <span class="st">"Centre"</span> <span class="sc">|</span> region <span class="sc">==</span> <span class="st">"Centre"</span> <span class="sc">|</span> region <span class="sc">==</span> <span class="st">"Centre"</span> <span class="sc">|</span> region <span class="sc">==</span> <span class="st">"Centre"</span> <span class="sc">|</span> <span class="er">///</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">==</span> <span class="st">"Haute-Normandie"</span> <span class="sc">|</span> region <span class="sc">==</span> <span class="st">"Limousin"</span> <span class="sc">|</span> region <span class="sc">==</span> <span class="st">"Pays de la Loire"</span> <span class="sc">|</span> <span class="er">///</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">==</span> <span class="st">"Poitou-Charentes"</span> <span class="sc">|</span> region <span class="sc">==</span> <span class="st">"Rhône-Alpes"</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>replace groups <span class="ot">=</span> <span class="dv">3</span> <span class="cf">if</span> region <span class="sc">==</span> <span class="st">"Île de France"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can map the data, putting our RGB colour codes into the <code>fcolor</code> command: <code>fcolor("230 159 0" "86 180 233" "0 158 115")</code>. In addition, we label our groups in the legend and set appropriate breaks with the <code>clbreaks</code> command.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Orange: "230 159 0"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Blue: "86 180 233"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Green: "0 158 115"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a> <span class="co"># Put the rgb values for the colours into the `fcolor` command, and then put the labels into the legend.</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>spmap groups using <span class="st">"nutscoord.dta"</span> <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">1950</span>, <span class="fu">id</span>(_ID) <span class="fu">fcolor</span>(<span class="st">"230 159 0"</span> <span class="st">"86 180 233"</span> <span class="st">"0 158 115"</span>) <span class="fu">legend</span>(<span class="fu">pos</span>(<span class="dv">9</span>)) <span class="fu">legstyle</span>(<span class="dv">2</span>) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">"Regional GDP per Capita - 1950"</span>, <span class="fu">size</span>(medium)) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">osize</span>(<span class="fl">0.02</span> ..) <span class="fu">ocolor</span>(white ..) <span class="sc">/</span><span class="er">//</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clmethod</span>(custom) <span class="fu">clbreaks</span>(<span class="dv">0</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span>) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">legend</span>(<span class="fu">order</span>(<span class="dv">2</span> <span class="st">"MLP"</span> <span class="dv">3</span> <span class="st">"EM"</span> <span class="dv">4</span> <span class="st">"JLM"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is what the map looks like:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lab-Q-and-A-resources/France.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Map of France with regions</figcaption>
</figure>
</div>
</section>
<section id="morans-i" class="level2">
<h2 class="anchored" data-anchor-id="morans-i">Moran’s I</h2>
<p>Q: How do I calculate Moran’s I in Stata?</p>
<p>A: We need to calculate the spatial weighting matrix, and then calculate Moran’s I.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Moran’s I
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://stats.oarc.ucla.edu/stata/faq/how-can-i-calculate-morans-i-in-stata/#:~:text=Moran's%20I%20is%20a%20measure,calculate%20Moran's%20I%20in%20Stata.">Moran’s I</a> is a measure of spatial autocorrelation–how related the values of a variable are based on the locations where they were measured. In other words, <a href="http://fmwww.bc.edu/RePEc/bocode/m/moransi.pdf">global spatial autocorrelation</a> measures the extent to which regions are interdependent.</p>
</div>
</div>
<p>To calculate Moran’s I, first we need to calculate the spatial weighting matrix. This matrix shows us how far each region is away from every other region. To calculate this matrix, we need to find the midpoint of each region. There are multiple ways to do this, but we will go with the simplest, which is to take the mean of all of the coordinates that make up the polygon.</p>
<p>We install the user written command that allows us to calculate the spatial weighting matrix <code>sg162</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>clear all</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>set more off</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># Install required user written command</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>ssc install sg162</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we find the mean x and y coordinates of each region and join this to our data from the <strong>regional_dataset</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>use nutscoord, clear </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>bysort _ID<span class="sc">:</span> egen mean_x <span class="ot">=</span> <span class="fu">mean</span>(_X)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>bysort _ID<span class="sc">:</span> egen mean_y <span class="ot">=</span> <span class="fu">mean</span>(_Y)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>keep _ID mean_x mean_y</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>duplicates drop</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>merge <span class="dv">1</span><span class="sc">:</span>m _ID using regional_dataset</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>keep <span class="cf">if</span> _merge <span class="sc">==</span> <span class="dv">3</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>drop _merge</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we choose a year to calculate Moran’s I for:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>keep <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">2000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And calculate the <strong>spat</strong>ial <strong>w</strong>eighting <strong>mat</strong>rix with the <strong>spatwmat</strong> command.</p>
<p>The band option allows us to drop any outliers which are too far away to be considered neighbours. We include all regions by setting the band’s upper bound very high.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>spatwmat, <span class="fu">name</span>(nutsweights) <span class="fu">xcoord</span>(mean_x) <span class="fu">ycoord</span>(mean_y) <span class="fu">band</span>(<span class="dv">0</span> <span class="fl">1.2e+06</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output that we get looks like this:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lab-Q-and-A-resources/moran-i-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Spatial weighting matrix output</figcaption>
</figure>
</div>
<p>To calculate Moran’s I for 2010 with regional GDP per capita, we use the weights we have calculated and the following command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>spatgsa regional_gdp_cap_1990, <span class="fu">weights</span>(nutsweights) moran</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output looks like this:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lab-Q-and-A-resources/moran-i-2.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Moran’s I calculation output</figcaption>
</figure>
</div>
<p>Based on these results, we can reject the null hypothesis that there is zero spatial autocorrelation present in the variable regional_gdp_cap_1990 at alpha = .05. In other words, regional GDP per capita is related to geography in 2010.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">If you have any questions, please feel free to <a href="mailto:jonathan.jayes@ekh.lu.se">contact me here <i class="fa-solid fa-paper-plane" aria-label="paper-plane"></i></a></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>