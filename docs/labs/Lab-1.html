<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vinzent Ostermeyer, adapted Jonathan Jayes">
<meta name="dcterms.date" content="2023-01-30">

<title> - Stata Lab 1 Mapping Growth: Basic Maps</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title"><i class="fa-solid fa-map" aria-label="map"></i></span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#purpose" id="toc-purpose" class="nav-link active" data-scroll-target="#purpose">Purpose</a></li>
  <li><a href="#structure" id="toc-structure" class="nav-link" data-scroll-target="#structure">Structure</a></li>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started">Getting started</a>
  <ul class="collapse">
  <li><a href="#install-additional-programs-and-set-up" id="toc-install-additional-programs-and-set-up" class="nav-link" data-scroll-target="#install-additional-programs-and-set-up">Install additional programs and set-up</a></li>
  </ul></li>
  <li><a href="#data-types" id="toc-data-types" class="nav-link" data-scroll-target="#data-types">Data types</a>
  <ul class="collapse">
  <li><a href="#importing-the-roses-wolf-dataset-from-excel-into-stata" id="toc-importing-the-roses-wolf-dataset-from-excel-into-stata" class="nav-link" data-scroll-target="#importing-the-roses-wolf-dataset-from-excel-into-stata">Importing the Roses-Wolf dataset from Excel into Stata</a></li>
  <li><a href="#importing-the-shapefiles-into-stata" id="toc-importing-the-shapefiles-into-stata" class="nav-link" data-scroll-target="#importing-the-shapefiles-into-stata">Importing the shapefiles into Stata</a></li>
  <li><a href="#merge-shapefiles-and-data-together" id="toc-merge-shapefiles-and-data-together" class="nav-link" data-scroll-target="#merge-shapefiles-and-data-together">Merge shapefiles and data together</a></li>
  </ul></li>
  <li><a href="#formatting-and-creating-variables" id="toc-formatting-and-creating-variables" class="nav-link" data-scroll-target="#formatting-and-creating-variables">Formatting and Creating Variables</a></li>
  <li><a href="#summary-statistics" id="toc-summary-statistics" class="nav-link" data-scroll-target="#summary-statistics">Summary statistics</a>
  <ul class="collapse">
  <li><a href="#tab-for-summaries-of-categorical-variables." id="toc-tab-for-summaries-of-categorical-variables." class="nav-link" data-scroll-target="#tab-for-summaries-of-categorical-variables.">Tab for summaries of categorical variables.</a></li>
  <li><a href="#summarize-for-summaries-of-numeric-variables" id="toc-summarize-for-summaries-of-numeric-variables" class="nav-link" data-scroll-target="#summarize-for-summaries-of-numeric-variables">Summarize for summaries of numeric variables</a></li>
  <li><a href="#exporting-summary-tables" id="toc-exporting-summary-tables" class="nav-link" data-scroll-target="#exporting-summary-tables">Exporting summary tables</a></li>
  </ul></li>
  <li><a href="#basic-maps" id="toc-basic-maps" class="nav-link" data-scroll-target="#basic-maps">Basic maps</a>
  <ul class="collapse">
  <li><a href="#basic-command" id="toc-basic-command" class="nav-link" data-scroll-target="#basic-command">Basic command</a></li>
  <li><a href="#adding-titles-and-notes" id="toc-adding-titles-and-notes" class="nav-link" data-scroll-target="#adding-titles-and-notes">Adding titles and notes</a></li>
  <li><a href="#introducing-a-fill" id="toc-introducing-a-fill" class="nav-link" data-scroll-target="#introducing-a-fill">Introducing a fill</a></li>
  <li><a href="#change-the-colour-palette" id="toc-change-the-colour-palette" class="nav-link" data-scroll-target="#change-the-colour-palette">Change the colour palette</a></li>
  <li><a href="#change-the-formatting-of-the-legend" id="toc-change-the-formatting-of-the-legend" class="nav-link" data-scroll-target="#change-the-formatting-of-the-legend">Change the formatting of the legend</a></li>
  <li><a href="#fix-legend-formatting" id="toc-fix-legend-formatting" class="nav-link" data-scroll-target="#fix-legend-formatting">Fix legend formatting</a></li>
  <li><a href="#change-legend-breaks-and-add-a-title" id="toc-change-legend-breaks-and-add-a-title" class="nav-link" data-scroll-target="#change-legend-breaks-and-add-a-title">Change legend breaks and add a title</a></li>
  <li><a href="#what-do-we-do-about-the-areas-with-no-data" id="toc-what-do-we-do-about-the-areas-with-no-data" class="nav-link" data-scroll-target="#what-do-we-do-about-the-areas-with-no-data">What do we do about the areas with no data?</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Stata Lab 1 Mapping Growth: Basic Maps</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vinzent Ostermeyer, adapted Jonathan Jayes </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 30, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="purpose" class="level2">
<h2 class="anchored" data-anchor-id="purpose">Purpose</h2>
<p>üó∫Ô∏è One goal of this course is to teach students how to identify a good map ‚Äì one which is clear, informative and attractive ‚Äì and familiarise students with the commands which allow the creation of these maps in Stata.üìà</p>
<p>In addition, your lab paper (üìÖ due March 3rd) requires that you include at least 6 maps, so it is worth concentrating in the labs and making use of these resources.üìù</p>
<p>üìö This document is intended to allow you to keep up with the Stata Lab 1 that we will work through in class.üìä</p>
<p>You can read the document on this website, or download the same information in <a href="Lab-1.pdf">pdf format hereüìö</a>.</p>
<p>It will include the commands the we use and the output, as well as some hints and tips that will be useful during your projects, I hope.ü§û</p>
</section>
<section id="structure" class="level2">
<h2 class="anchored" data-anchor-id="structure">Structure</h2>
<p>Today we will be covering the following topics:</p>
<ol type="1">
<li><p>Installing basic packages: We will go over how to install the necessary packages in order to run our analysis. This will include packages such as ‚Äúspmap‚Äù and ‚Äúgeo2xy‚Äù which will allow us to create maps in Stata.</p></li>
<li><p>Data types: We will discuss the different types of data that we will be working with in this lab. Specifically, we will be using time series data from a spreadsheet and map data from a shapefile. It is important to understand the structure and format of these data types in order to properly analyze and visualize them.</p></li>
<li><p>Basic mapping: Once we have our data, we will learn how to draw a basic map using the ‚Äúmaps‚Äù and ‚Äúmaptools‚Äù packages. We will go over how to import the shapefile data, how to define the map scale, and how to add different layers to the map such as points, lines, and polygons.</p></li>
</ol>
<p>By the end of this lab, you should have a solid understanding of how to install necessary packages, how to work with different types of data, and how to draw a basic map in Stata.</p>
<p>üìäüó∫Ô∏èüíª Let‚Äôs get started!</p>
</section>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting started</h2>
<p>Given that you have encountered Stata previously in your studies, I will not spend undue time explaining the basics. If you want to brush up on Stata‚Äôs syntax, I recommend having a look at <a href="https:#github.com/j-jayes/EOSE09/blob/b8444dd95783f4434ab63c4ad28b0f3033d4fd0a/resources/StataTutorial.pdf">these slides</a> from Oscar Torres-Reyna, or <a href="https:#www.youtube.com/watch?v=oXsPgQe-aqs&amp;ab_channel=SebastianWaiEcon">this set of Youtube videos</a> From Sebastian Wai. I‚Äôve put together a comprehensive set of resources on <a href="resources/resources.qmd">this page here</a>.</p>
<section id="install-additional-programs-and-set-up" class="level3">
<h3 class="anchored" data-anchor-id="install-additional-programs-and-set-up">Install additional programs and set-up</h3>
<p>First we need to install the packages in Stata that we will make use of. Please do this before our lab session in order to save time.</p>
<p>We use the <code>ssc install</code> command, as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>ssc install spmap, replace</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>ssc install geo2xy, replace</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>ssc install shp2dta, replace</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>ssc install schemepack, replace</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>ssc install scheme<span class="sc">-</span>burd, replace</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>ssc install colrspace, replace</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>ssc install palettes, replace</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>ssc install egenmore, replace</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>ssc install outreg2, replace</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>To run do-files click the ‚Äúrun-button‚Äù or highlight the lines of code and hit ctrl + D (Windows) or shift + cmd + D (Mac)</p>
</div>
</div>
<p>Running the command should produce output in the console that looks like this:</p>
<blockquote class="blockquote">
<p><strong>. ssc install geo2xy, replace</strong><br>
&nbsp;&nbsp;<code>checking geo2xy consistency and verifying not already installed...</code><br>
&nbsp;&nbsp;<code>installing into c:\ado\plus\... installation complete.</code><br>
&nbsp;&nbsp;<code>...</code></p>
</blockquote>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Always comment your code
</div>
</div>
<div class="callout-body-container callout-body">
<p>In Stata you can comment your code in one line</p>
<p><code># like so</code></p>
<p>Or if you want to write a longer string</p>
<p><code>/*You can put your longer string of text inside a set of slashes and stars*/</code></p>
</div>
</div>
<section id="setting-a-directory" class="level4">
<h4 class="anchored" data-anchor-id="setting-a-directory">Setting a directory</h4>
<p>It is useful to put all of your work inside a specific file directory. This way, Stata knows where to look for your files and where to save output, like regression tables.</p>
<p>The path to my folder where I have the files for this lab is:</p>
<p><code>C:/Users/User/Documents/Recon/EOSE09/stata_files/</code></p>
<p>If you have a Mac, it will look something like this:</p>
<p><code>Users/Jonathan/Documents/Stata-lab/</code></p>
<p>If you want to change the settings on your Mac to display the file path in your <strong>Finder</strong> window, follow <a href="https:#www.lifewire.com/use-macs-hidden-finder-path-bar-2260868">this link</a>.</p>
<p>To tell Stata that this is where I want it to look for my files, I‚Äôll use the <code>cd</code> (current directory) command in my do-file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>cd <span class="st">"C:/Users/User/Documents/Recon/EOSE09/stata_files/"</span> <span class="co"># set your directory</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If successful, in the console I will see the following output:</p>
<blockquote class="blockquote">
<p><strong>. <code>cd "C:/Users/User/Documents/Recon/EOSE09/stata_files/" # set your directory</code></strong><br>
&nbsp;&nbsp;<code>C:\Users\User\Documents\Recon\EOSE09\stata_files</code></p>
</blockquote>
<p>You can call the help window by typing <code>help</code> into the console, and set your Stata version for compatability reasons with the <code>version</code> command, like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>help <span class="co"># Stata's help function; cf. also the web or Statalist</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>version <span class="fl">16.1</span> <span class="co"># version control</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="data-types" class="level2">
<h2 class="anchored" data-anchor-id="data-types">Data types</h2>
<p>In order to draw a map in Stata, we need to combine the information from our shapefile (which contains the geographic information such as the shape and location of the features on the map) with the information from our spreadsheet (which contains the data we want to display on the map, such as population or income).</p>
<p>The process of combining these two types of data is called ‚Äújoining‚Äù or ‚Äúmerging‚Äù and it allows us to link the attributes from the spreadsheet to the geographic features in the shapefile. Without joining the data, we would only have the shape of the features on the map, but not the information we want to display.</p>
<p>You are likely familiar with the first type of data, it is a wide dataset in an excel spreadsheet.</p>
<p>The second is a <code>shapefile</code> - a file that stores the information a software program needs to draw a map.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Shapefiles üó∫Ô∏èüìäüíªüìÇ
</div>
</div>
<div class="callout-body-container callout-body">
<p>A shapefile is a type of data file that is used to store geographic information, such as the location of streets, buildings, and other features on a map. It is a common format used in geographic information systems (GIS) software.</p>
<p>A shapefile consists of four components with different file extensions:</p>
<ul>
<li><p>.shp (shapefile): This file stores the actual geometric data for the features in the map, such as the shape of a street or a building.</p></li>
<li><p>.shx (shape index): This file stores the index of the geometric data in the .shp file, which is used to quickly access the data in the correct order.</p></li>
<li><p>.dbf (database file): This file stores the attribute data for the features in the map, such as the name of a street or the population of a building.</p></li>
<li><p>.prj (projection file): This file stores information about the coordinate system and projection used for the data in the shapefile. This is important for ensuring that the map is displayed correctly and that measurements are accurate.</p></li>
</ul>
<p>Together, these four files make up a complete shapefile and are necessary to properly display and analyze the geographic information.</p>
</div>
</div>
<section id="importing-the-roses-wolf-dataset-from-excel-into-stata" class="level3">
<h3 class="anchored" data-anchor-id="importing-the-roses-wolf-dataset-from-excel-into-stata">Importing the Roses-Wolf dataset from Excel into Stata</h3>
<p>At the moment, the database we want to use to draw our maps is in an excel sheet.</p>
<p>It has many tabs, and some lines are filled with headings before the data begins, as shown here:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lab-1-resources/excel_format.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Screenshot of excel file</figcaption><p></p>
</figure>
</div>
<p>What we want to do is import the data from each tab, and append it together.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>import excel using RosesWolf_RegionalGDP_v6.xlsx, <span class="fu">sheet</span>(<span class="st">"A1 Regional GDP"</span>) firstrow <span class="fu">cellrange</span>(A6<span class="sc">:</span>O179) clear <span class="co"># import Excel sheet</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span> (D E F G H I J K L M N O) (year_1900 year_1910 year_1925 year_1938 year_1950 year_1960 year_1970 year_1980 year_1990 year_2000 year_2010 year_2015)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is what the data now looks like inside Stata. It is a wide dataframe, with 173 rows (the number of regions) and 15 variables (3 identifiers and 12 years worth of data)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lab-1-resources/stata_view_1.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Screenshot of Stata format</figcaption><p></p>
</figure>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Recall that the Roses Wolf database has geographic data on GDP and population at the nomenclature of territorial units 2 (NUTS-2) level, from 1900 to 2015.</p>
<p>If you want to have a look at this data in more detail, have a look at <a href="https://jonathan-jayes.shinyapps.io/Roses-Wolf-database-on-regional-GDP/">this Shiny app</a>.</p>
</div>
</div>
<p>Next we want to be sure that Stata is reading in the values as numbers rather than text. For this we use the <code>destring</code> command.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>import excel using RosesWolf_RegionalGDP_v6.xlsx, <span class="fu">sheet</span>(<span class="st">"A1 Regional GDP"</span>) firstrow <span class="fu">cellrange</span>(A6<span class="sc">:</span>O179) clear allstring <span class="st">`</span><span class="at"># we import each sheet in the Excel file separately and save it as one file</span><span class="st">`</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span> (D E F G H I J K L M N O) (year_1900 year_1910 year_1925 year_1938 year_1950 year_1960 year_1970 year_1980 year_1990 year_2000 year_2010 year_2015)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    destring year_<span class="sc">*</span>, replace</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If there are non-numerical values in a string you cannot use destring and should not use the force-option as it would create missing values A better approach is to check all cases that are non-numerical and replace them (e.g.&nbsp;change ‚Äúone‚Äù to ‚Äú1‚Äù)</p>
<p>Other common data cleaning commands could include:</p>
<p><code># tab var1 if missing(real(var1))</code> <code># replace var1 ... if ...</code> <code># destring var1, replace</code></p>
<p>Next we want to take the data from a wide format to a long format. A long format means that each row is an observation, each column is a variable, and each cell has just one value in it.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lab-1-resources/wide_to_long.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Reshape graphic</figcaption><p></p>
</figure>
</div>
<p>The reshape command in Stata is used to change the shape of the data from one format to another. In this specific case, the reshape long option is used to change the data from a ‚Äúwide‚Äù format to a ‚Äúlong‚Äù format.</p>
<p>The variables that come after ‚Äúyear_‚Äù are the variables that will be converted from wide to long format. In this case, ‚Äúyear_‚Äù is not a variable, it is a prefix of the variables that will be reshaped.</p>
<p>The option i(NUTSCodes Region Countrycurrentborder) specifies the identifier variables, which are variables that uniquely identify the observations in the dataset and will not be reshaped. In this case, ‚ÄúNUTSCodes‚Äù, ‚ÄúRegion‚Äù, and ‚ÄúCountrycurrentborder‚Äù are the identifier variables.</p>
<p>The option j(year) specifies the variable that will be used as the new variable name for the reshaped variables. In this case, the new variable name will be ‚Äúyear‚Äù and it will be the identifier of the year of the data.</p>
<p>We save the data as a <code>.dta</code> file with the <code>save</code> command. The replace option overwrites any file with the same name in the directory.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>help reshape <span class="co"># Read up about the command here</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>reshape long year_, <span class="fu">i</span>(NUTSCodes Region Countrycurrentborder) <span class="fu">j</span>(year)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>rename year_ regional_gdp_millions</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>save regional_gdp, replace </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Never overwrite your raw data - this could be a big problem if you haven‚Äôt saved it somewhere else. Good practice is to save a copy of your data in a different folder before the analysis, and make any changes through your do-file (e.g.&nbsp;changing ‚Äúone‚Äù to ‚Äú1‚Äù in Stata rather than excel).</p>
</div>
</div>
<p>Now we can see the data in a long format if we use the browse (<code>br</code>) command:</p>
<p><img src="Lab-1-resources/regional_gdp.PNG" class="img-fluid"></p>
<p>We repeat this process for the remaining sheets in the Excel workbook.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>import excel using RosesWolf_RegionalGDP_v6.xlsx, <span class="fu">sheet</span>(<span class="st">"A1b Regional GDP (2011PPP)"</span>) firstrow <span class="fu">cellrange</span>(A6<span class="sc">:</span>O179) clear allstring <span class="co"># repetition of the steps above for each sheet</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span> (D E F G H I J K L M N O) (year_1900 year_1910 year_1925 year_1938 year_1950 year_1960 year_1970 year_1980 year_1990 year_2000 year_2010 year_2015)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>destring year_<span class="sc">*</span>, replace</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>reshape long year_, <span class="fu">i</span>(NUTSCodes Region Countrycurrentborder) <span class="fu">j</span>(year)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>rename year_ regional_gdp_2011_ppp_millions</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>save regional_gdp_2011_ppp, replace</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importing-the-shapefiles-into-stata" class="level3">
<h3 class="anchored" data-anchor-id="importing-the-shapefiles-into-stata">Importing the shapefiles into Stata</h3>
<p>Describe importing a shapefile into Stata</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>clear <span class="co"># clear the dataset in memory</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>shp2dta using regions_nuts2, <span class="fu">database</span>(regions) <span class="fu">coordinates</span>(nutscoord) <span class="fu">genid</span>(_ID) replace</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have a little data cleaning to do: There are three particular regions that need to be joined together in the Roses-Wolf database in order to be plotted correctly. If we don‚Äôt correct these, there will be holes in our map, as shown below:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lab-1-resources/hole_in_map.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Screenshot from <a href="https://jonathan-jayes.shinyapps.io/Roses-Wolf-database-on-regional-GDP/">my Shiny app</a></figcaption><p></p>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>use regions, clear <span class="co"># fixing the identifier of the NUTS_Codes so that the merge below works for all regions in the dataset</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>replace NUTS_CODE <span class="ot">=</span> <span class="st">"AT12+AT13"</span> <span class="cf">if</span> NUTS_CODE <span class="sc">==</span> <span class="st">"AT123"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>replace NUTS_CODE <span class="ot">=</span> <span class="st">"DE71+DE72"</span> <span class="cf">if</span> NUTS_CODE <span class="sc">==</span> <span class="st">"DE712"</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>replace NUTS_CODE <span class="ot">=</span> <span class="st">"DE91+DE92"</span> <span class="cf">if</span> NUTS_CODE <span class="sc">==</span> <span class="st">"DE912"</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>save regions, replace</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="projections" class="level4">
<h4 class="anchored" data-anchor-id="projections">Projections</h4>
<p>Map projections are methods used to represent the surface of the Earth on a flat map. Different projections have different properties, such as preserving area, shape, or direction, and each has its own set of distortions. The Mercator projection is a cylindrical projection that was developed in the 16th century for navigation. It is particularly useful for representing the entire globe at once, but it distorts the size and shape of landmasses near the poles.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Mercator popularity
</div>
</div>
<div class="callout-body-container callout-body">
<p>Web Mercator, also known as Google Web Mercator, Spherical Mercator, WGS 84 Web Mercator or WGS 84/Pseudo-Mercator, is a variant of the Mercator projection that is optimized for use on the web. It is the projection used by Google Maps, OpenStreetMap, and many other online mapping services.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lab-1-resources/projections.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Obligatory <a href="https:#xkcd.com/977/">XKCD comic</a></figcaption><p></p>
</figure>
</div>
<p>Have a look at <a href="https:#www.statalist.org/forums/forum/general-stata-discussion/general/1306288-legend-in-spmap">this link</a> to the Stata forum that explains different projections.</p>
</div>
</div>
<p>We will use the Albers projection, which is saved as <code>nutscoord.dta</code> in your working directory.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>use nutscoord, clear <span class="co"># we use the Albers projection; every projection looks a bit different</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let‚Äôs give a gander what the projection looks using the <code>scatter</code> command.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>scatter _Y _X</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>scatter _Y _X, <span class="fu">msize</span>(tiny) <span class="fu">msymbol</span>(point)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-scatter" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-no-opts" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Lab-1-resources/scatter_no_opts.png" class="img-fluid figure-img" data-ref-parent="fig-scatter"></p>
<p></p><figcaption class="figure-caption">(a) Scatter with no options</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-opts" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Lab-1-resources/scatter_with_opts.png" class="img-fluid figure-img" data-ref-parent="fig-scatter"></p>
<p></p><figcaption class="figure-caption">(b) Scatter specifying msize and msymbol</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Comparison of scatter plots</figcaption><p></p>
</figure>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Scatter options
</div>
</div>
<div class="callout-body-container callout-body">
<p>The msize() option in the scatter command is used to set the size of the markers in the graph. The markers can be circles, squares, or other shapes, and the size option controls their overall size. The value of the option can be a number, which represents the size in units of the graph, or a variable name, which represents the size relative to the values of that variable.</p>
<p>The msymbol() option in the scatter command is used to set the shape of the markers in the graph. The markers can be circles, squares, or other shapes, and the msymbol option controls their shape. The value of the option can be a number, which represents the shape, or a variable name, which represents the shape relative to the values of that variable.</p>
</div>
</div>
<p>You can experiment with other projections, have a look at the <code>geo2xy</code> help file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>help geo2xy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lab-1-resources/stata_projections.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Stata‚Äôs projections</figcaption><p></p>
</figure>
</div>
</section>
</section>
<section id="merge-shapefiles-and-data-together" class="level3">
<h3 class="anchored" data-anchor-id="merge-shapefiles-and-data-together">Merge shapefiles and data together</h3>
<p>We‚Äôre nearly there! Now we have both file types in the correct format in Stata. All that is left to do is merge them together so that we can plot maps with the Roses-Wolf data.</p>
<p>We start by importing our clean, long format data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>use regional_gdp, clear <span class="co"># we merge all created files together</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We are going to use the <code>merge</code> command. Read more about it by typing <code>help merge</code> into the console.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lab-1-resources/merge_stata.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Merge explained</figcaption><p></p>
</figure>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Merge types
</div>
</div>
<div class="callout-body-container callout-body">
<p>1:1 matches occur when each observation in one dataset has a unique match in the other dataset, based on the specified variable(s). This is the most common type of match and is the default behavior of the merge command.</p>
<p>1:m matches occur when one observation in one dataset has multiple matches in the other dataset, based on the specified variable(s). This can happen when there are duplicate values in the specified variable(s) in one of the datasets.</p>
<p>m:m matches occur when multiple observations in one dataset have multiple matches in the other dataset, based on the specified variable(s). This is the least common type of match, as it requires duplicate values in the specified variable(s) in both datasets.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>merge <span class="dv">1</span><span class="sc">:</span><span class="dv">1</span> NUTSCodes year using regional_gdp_2011_ppp <span class="co"># this is a 1:1 merge</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>drop _merge</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should get output that looks like so:</p>
<blockquote class="blockquote">
<p><strong>. merge 1:1 NUTSCodes year using regional_gdp_2011_ppp # this is a 1:1 merge</strong><br>
&nbsp;&nbsp;&nbsp;Result # of obs.<br>
&nbsp;&nbsp;&nbsp;‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äì<br>
&nbsp;&nbsp;&nbsp;not matched 0<br>
&nbsp;&nbsp;&nbsp;matched 2,076 (_merge==3)<br>
&nbsp;&nbsp;&nbsp;‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äì</p>
</blockquote>
<p>We now repeat the process for all of our variables in the Roses-Wolf database.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>merge <span class="dv">1</span><span class="sc">:</span><span class="dv">1</span> NUTSCodes year using population, <span class="fu">assert</span>(match) nogen</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>merge <span class="dv">1</span><span class="sc">:</span><span class="dv">1</span> NUTSCodes year using share_agriculture, <span class="fu">assert</span>(match) nogen</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>merge <span class="dv">1</span><span class="sc">:</span><span class="dv">1</span> NUTSCodes year using share_industry, <span class="fu">assert</span>(match) nogen</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>merge <span class="dv">1</span><span class="sc">:</span><span class="dv">1</span> NUTSCodes year using share_services, <span class="fu">assert</span>(match) nogen</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we add in area to all of the variables with an m:1 merge</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>merge m<span class="sc">:</span><span class="dv">1</span> NUTSCodes using area_km2, <span class="fu">assert</span>(match) nogen <span class="co"># this is a m:1 merge; there is also a 1:m merges; m:m merges are a bad idea</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let‚Äôs fix our nomenclature</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>rename NUTSCodes NUTS_CODE</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>merge m<span class="sc">:</span><span class="dv">1</span> NUTS_CODE using regions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let‚Äôd now drop all of the regions for which there is map information, but no data from the Roses-Wolf database.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>drop <span class="cf">if</span> _merge <span class="sc">==</span> <span class="dv">2</span> <span class="co"># we keep all regions that are merged and delete those for which we have geographical information but no data</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>drop _merge</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>order _ID, <span class="fu">after</span>(NUTS_CODE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wonderful! Now we have joined together our geographic information from the shapefiles with the data from the Roses-Wolf database.</p>
</section>
</section>
<section id="formatting-and-creating-variables" class="level2">
<h2 class="anchored" data-anchor-id="formatting-and-creating-variables">Formatting and Creating Variables</h2>
<p>This next section is first setting up some calculated variables (e.g.&nbsp;dividing GDP by population for GDP per capita) and secondly adding nice names that are easy to understand what we are up to.</p>
<p>We start by renaming our variables from title case to snake case (where words are in lower case and separated by underscores)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>rename Countrycurrentborder country</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span> (Region regional_gdp_millions regional_gdp_2011_ppp_millions population_thousands area_km2) (region regional_gdp_1990 regional_gdp_2011 regional_population regional_area) <span class="co"># cleaning the dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we change our GDP and population values from being denominated in millions and thousands to basic levels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>replace regional_gdp_1990 <span class="ot">=</span> regional_gdp_1990 <span class="sc">*</span> <span class="dv">1000000</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>replace regional_gdp_2011 <span class="ot">=</span> regional_gdp_2011 <span class="sc">*</span> <span class="dv">1000000</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>replace regional_population <span class="ot">=</span> regional_population <span class="sc">*</span> <span class="dv">1000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we sum across countries and years to create a summary value for national GDP and national population from the regional values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>bysort country year<span class="sc">:</span> egen national_gdp_1990 <span class="ot">=</span> <span class="fu">total</span>(regional_gdp_1990)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>bysort country year<span class="sc">:</span> egen national_population <span class="ot">=</span> <span class="fu">total</span>(regional_population)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Creating per capita values at national and regional levels:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>gen national_gdp_cap_1990 <span class="ot">=</span> national_gdp_1990 <span class="sc">/</span> national_population</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>gen regional_gdp_cap_1990 <span class="ot">=</span> regional_gdp_1990 <span class="sc">/</span> regional_population</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>gen regional_gdp_cap_2011 <span class="ot">=</span> regional_gdp_2011 <span class="sc">/</span> regional_population</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>sort country region year</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Creating a population density variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>gen population_density <span class="ot">=</span> regional_population <span class="sc">/</span> regional_area <span class="co"># you often have to calculate new variables, which you then can map</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we are going to make use of a very powerful command, <code>egen</code> , in combiation with the <code>xtile</code> command to create five groups of regions, based on their where they fall in percentile of regional GDP per capita, for every year which we have data on them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>egen q_regional_gdp_cap_1990 <span class="ot">=</span> <span class="fu">xtile</span>(regional_gdp_cap_1990), <span class="fu">n</span>(<span class="dv">5</span>) <span class="fu">by</span>(year) <span class="co"># you can change the number of groups</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>sort country region year</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we are going to create a variable for GDP per capita at the regional level for each region, relative to the average of the entire sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>bysort year<span class="sc">:</span> egen mean_gdp_cap_eu <span class="ot">=</span> <span class="fu">mean</span>(regional_gdp_cap_1990)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>sort country region year</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>gen relative_gdp_cap_eu <span class="ot">=</span> regional_gdp_cap_1990 <span class="sc">/</span> mean_gdp_cap_eu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we do the same for the country level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>bysort year country<span class="sc">:</span> egen mean_gdp_cap_country <span class="ot">=</span> <span class="fu">mean</span>(regional_gdp_cap_1990)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>sort country region year</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>gen relative_gdp_cap_country <span class="ot">=</span> regional_gdp_cap_1990 <span class="sc">/</span> mean_gdp_cap_country</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we are going to add some nice labels so that when we draw our graphs they get nice legends by default.</p>
<p>In Stata you can have a variable name (e.g.&nbsp;‚Äúcountry‚Äù), and a variable label (a long string e.g.&nbsp;‚ÄúCountry in Current Borders‚Äù).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>label variable _ID <span class="st">"Region ID"</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>label variable year <span class="st">"Year"</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>label variable country <span class="st">"Country in Current Borders"</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>label variable regional_gdp_1990 <span class="st">"Regional GDP in 1990 International Dollars"</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>label variable regional_population <span class="st">"Regional Population"</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>label variable employment_share_agriculture <span class="st">"Regional Share of Employment in Agriculture"</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>label variable employment_share_industry <span class="st">"Regional Share of Employment in Industry"</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>label variable employment_share_services <span class="st">"Regional Share of Employment in Services"</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>label variable regional_area <span class="st">"Area in KM2"</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>label variable national_gdp_1990 <span class="st">"National GDP in 1990 International Dollars"</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>label variable national_gdp_cap_1990 <span class="st">"National GDP per Capita in 1990 International Dollars"</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>label variable regional_gdp_cap_1990 <span class="st">"Regional GDP per Capita in 1990 International Dollars"</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>label variable national_population <span class="st">"National Population"</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>format region NUTS_CODE %20s</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>save regional_dataset, replace</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summary-statistics" class="level2">
<h2 class="anchored" data-anchor-id="summary-statistics">Summary statistics</h2>
<p>In this section we use the <code>tab</code> and <code>summarize</code> commands to create summary statistics. To export our summary statistics, we use the <code>outreg2</code> command.</p>
<section id="tab-for-summaries-of-categorical-variables." class="level3">
<h3 class="anchored" data-anchor-id="tab-for-summaries-of-categorical-variables.">Tab for summaries of categorical variables.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>use regional_dataset, clear</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>tab country</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="Lab-1-resources/tab_country.PNG" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>tab region</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summarize-for-summaries-of-numeric-variables" class="level3">
<h3 class="anchored" data-anchor-id="summarize-for-summaries-of-numeric-variables">Summarize for summaries of numeric variables</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>summarize national_gdp_cap_1990 <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">1950</span>, detail</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>summarize regional_gdp_cap_1990 <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">1950</span>, detail</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>summarize regional_gdp_cap_1990 <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">2000</span>, detail</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can use the option <code>, detail</code> or simply <code>, d</code> after the summarize command to get summary values across the distribution, rather than just at the mean of the distribution.</p>
</div>
</div>
</section>
<section id="exporting-summary-tables" class="level3">
<h3 class="anchored" data-anchor-id="exporting-summary-tables">Exporting summary tables</h3>
<p>Here the <code>outreg2</code> command makes a table in MS Word format. To learn more about outreg2, see <a href="https:#www.princeton.edu/~otorres/Outreg2.pdf">this link</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>outreg2 using sum_table.doc, replace <span class="fu">sum</span>(log) <span class="fu">keep</span>(regional_gdp_cap_1990) <span class="fu">eqkeep</span>(N mean sd) label</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>outreg2 <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">1950</span> using sum_table_1950.doc, replace <span class="fu">sum</span>(log) <span class="fu">keep</span>(regional_gdp_cap_1990) <span class="fu">eqkeep</span>(N mean sd) label</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also use the <code>browse</code> command (shortened to <code>br</code>) to provide an easy to read summary within Stata.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>sort year regional_gdp_cap_1990</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>br region country regional_gdp_cap_1990 <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">1900</span> <span class="co"># compare with </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can compare this summary with table 2.6 in the course book.</p>
<p><img src="Lab-1-resources/browse_gdp_1900.PNG" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>br region country regional_gdp_cap_1990 <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">2010</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="basic-maps" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="basic-maps">Basic maps</h2>
<p>Now we get to the fun part! Let‚Äôs load our nice and tidy dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>use regional_dataset, clear</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>help spmap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spmap is aimed at visualizing several kinds of spatial data, and is<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;particularly suited for drawing thematic maps and displaying the results<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of spatial data analyses.</p>
</blockquote>
<section id="basic-command" class="level3">
<h3 class="anchored" data-anchor-id="basic-command">Basic command</h3>
<p>Here we draw a map with just the outline of our regions. We use the <code>nutscoord.dta</code> file as our map.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>spmap using <span class="st">"nutscoord.dta"</span> <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">1950</span>, <span class="fu">id</span>(_ID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="Lab-1-resources/spmap_1.PNG" class="img-fluid"></p>
</section>
<section id="adding-titles-and-notes" class="level3">
<h3 class="anchored" data-anchor-id="adding-titles-and-notes">Adding titles and notes</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>spmap using <span class="st">"nutscoord.dta"</span> <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">1960</span>, <span class="fu">id</span>(_ID) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">"My first Map"</span>, <span class="fu">size</span>(large)) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">note</span>(<span class="st">"Source: Ros√©s-Wolf (2020)"</span>, <span class="fu">size</span>(vsmall) <span class="fu">pos</span>(<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="Lab-1-resources/spmap_2.PNG" class="img-fluid"></p>
</section>
<section id="introducing-a-fill" class="level3">
<h3 class="anchored" data-anchor-id="introducing-a-fill">Introducing a fill</h3>
<p>Let‚Äôs now map the variable for National GDP per capita to the fill aesthetic for the year 1950.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>spmap national_gdp_cap_1990 using <span class="st">"nutscoord.dta"</span> <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">1950</span>, <span class="fu">id</span>(_ID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that we now get a legend in the bottom left hand corner that shows us what the different colours on the map mean. Look at Sweden and Denmark go!</p>
<p><img src="Lab-1-resources/spmap_3.PNG" class="img-fluid"></p>
</section>
<section id="change-the-colour-palette" class="level3">
<h3 class="anchored" data-anchor-id="change-the-colour-palette">Change the colour palette</h3>
<p>Here we use the palette <code>Blues2</code> to specify what colours we want to fill our base map polygons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>spmap regional_gdp_cap_1990 using <span class="st">"nutscoord.dta"</span> <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">1950</span>, <span class="fu">id</span>(_ID) <span class="fu">fcolor</span>(Blues2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="Lab-1-resources/spmap_4.PNG" class="img-fluid"></p>
</section>
<section id="change-the-formatting-of-the-legend" class="level3">
<h3 class="anchored" data-anchor-id="change-the-formatting-of-the-legend">Change the formatting of the legend</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>spmap regional_gdp_cap_1990 using <span class="st">"nutscoord.dta"</span> <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">1950</span>, <span class="fu">id</span>(_ID) <span class="fu">fcolor</span>(Blues2) <span class="fu">legend</span>(<span class="fu">pos</span>(<span class="dv">9</span>)) <span class="fu">legstyle</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That‚Äôs a bit better! The numbers still look horrid though.</p>
<p><img src="Lab-1-resources/spmap_5.PNG" class="img-fluid"></p>
</section>
<section id="fix-legend-formatting" class="level3">
<h3 class="anchored" data-anchor-id="fix-legend-formatting">Fix legend formatting</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>help format <span class="sc">/</span><span class="er">/</span> you can format any variable</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>format regional_gdp_cap_1990 %<span class="fl">12.0</span>fc <span class="sc">/</span><span class="er">/</span> <span class="dv">12</span> numbers left of the decimal point; <span class="dv">0</span> to the right; commas to denote thousands</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>spmap regional_gdp_cap_1990 using <span class="st">"nutscoord.dta"</span> <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">1950</span>, <span class="fu">id</span>(_ID) <span class="fu">fcolor</span>(Blues2) <span class="fu">legend</span>(<span class="fu">pos</span>(<span class="dv">9</span>)) <span class="fu">legstyle</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Stata number formatting
</div>
</div>
<div class="callout-body-container callout-body">
<p>In Stata, the number formatting for graphs is controlled by format codes.</p>
<p>The format code ‚Äú%12.0fc‚Äù is a combination of four parts:</p>
<ul>
<li>‚Äú%12‚Äù specifies the number of spaces to the left of the decimal point, in this case 12 spaces.</li>
<li>‚Äú.0‚Äù specifies the number of decimal places to be displayed, in this case 0.</li>
<li>‚Äúf‚Äù specifies the data type, in this case a floating point number</li>
<li>‚Äúc‚Äù specifies the format of the number, in this case including commas as the thousands separator.</li>
</ul>
<p>In general, format codes can be used to control the appearance of numbers in tables, graphs and other outputs in Stata. Each format code has a combination of width, decimal places and data type specifiers to format the numbers as desired.</p>
</div>
</div>
<p>That‚Äôs better!</p>
<p><img src="Lab-1-resources/spmap_6.PNG" class="img-fluid"></p>
</section>
<section id="change-legend-breaks-and-add-a-title" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="change-legend-breaks-and-add-a-title">Change legend breaks and add a title</h3>
<p>Let‚Äôs make the numbers in the legend more logical:</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>In Stata, the <code>clmethod()</code> command is used to specify the method for creating breaks (or intervals) on a color scale in a graph. The <code>clbreaks()</code> command is used to specify the values of the breaks.</p>
<p>In this specific example, the command ‚Äúclmethod(custom) clbreaks(0 (1000) 12000)‚Äù is used to create a custom color scale with the following properties:</p>
<ul>
<li>The scale starts at 0.</li>
<li>The gradations of the scale are 1,000.</li>
<li>The top end of the scale is 12,000.</li>
</ul>
<p>The <code>clbreaks()</code> command is set to ‚Äú0 (1000) 12000‚Äù which means that the color scale starts at 0 and continues to increase in increments of 1,000 up to 12,000. In other words, the scale will have 12 breaks or intervals: 0, 1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000, 9000, 10000, 11000, 12000.</p>
<p>This custom scale will be used to colour the data points in the graph accordingly.</p>
<p>It‚Äôs important to note that the command ‚Äúclmethod(custom)‚Äù is required to use the custom breaks defined in the ‚Äúclbreaks()‚Äù command.</p>
</div>
</div>
<p>The number of breaks is a stylistic choice and can impact the message that the reader takes away. Consider how the dark blue areas stand out in Sweden and the UK in the second figure, compared to the first.</p>
<p>(I think you see by now what the graph editor looks like - I‚Äôm saving the image from the editor from now on.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>spmap regional_gdp_cap_1990 using <span class="st">"nutscoord.dta"</span> <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">1950</span>, <span class="fu">id</span>(_ID) <span class="fu">fcolor</span>(Blues2) <span class="fu">legend</span>(<span class="fu">pos</span>(<span class="dv">9</span>)) <span class="fu">legstyle</span>(<span class="dv">2</span>) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">"Regional GDP per Capita - 1950 "</span>, <span class="fu">size</span>(medium)) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">osize</span>(<span class="fl">0.02</span> ..) <span class="fu">ocolor</span>(gs8 ..) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clmethod</span>(custom) <span class="fu">clbreaks</span>(<span class="dv">0</span> (<span class="dv">1000</span>) <span class="dv">12000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>spmap regional_gdp_cap_1990 using <span class="st">"nutscoord.dta"</span> <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">1950</span>, <span class="fu">id</span>(_ID) <span class="fu">fcolor</span>(Blues2) <span class="fu">legend</span>(<span class="fu">pos</span>(<span class="dv">9</span>)) <span class="fu">legstyle</span>(<span class="dv">1</span>) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">"Regional GDP per Capita - 1950"</span>, <span class="fu">size</span>(medium)) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">osize</span>(<span class="fl">0.02</span> ..) <span class="fu">ocolor</span>(white ..) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clmethod</span>(custom) <span class="fu">clbreaks</span>(<span class="dv">0</span> <span class="dv">3000</span> (<span class="dv">1000</span>) <span class="dv">6000</span> <span class="dv">12000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="column-page quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lab-1-resources/spmap_7.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Lots of breaks</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lab-1-resources/spmap_8.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Fewer breaks</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>Comparison of breaks</p>
</div>
</div>
</div>
</section>
<section id="what-do-we-do-about-the-areas-with-no-data" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="what-do-we-do-about-the-areas-with-no-data">What do we do about the areas with no data?</h3>
<p>Let‚Äôs have a look at the employment share in industry.</p>
<p>Look at the North of the UK in 1950 - such a powerhouse!</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>ndfcolor(gray)</code> command makes areas with no data greyed out (note the US spelling of gray vs grey)</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>spmap employment_share_industry using <span class="st">"nutscoord.dta"</span> <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">1950</span>, <span class="fu">id</span>(_ID) <span class="fu">fcolor</span>(Blues2) <span class="fu">legend</span>(<span class="fu">pos</span>(<span class="dv">9</span>)) <span class="fu">legstyle</span>(<span class="dv">2</span>) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">"Employment Share Industry - 1950"</span>, <span class="fu">size</span>(medium)) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">osize</span>(<span class="fl">0.02</span> ..) <span class="fu">ocolor</span>(white ..) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ndfcolor</span>(gray) <span class="fu">ndocolor</span>(none ..) <span class="fu">ndsize</span>(<span class="fl">0.02</span> ..)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>spmap employment_share_industry using <span class="st">"nutscoord.dta"</span> <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">1950</span>, <span class="fu">id</span>(_ID) <span class="fu">fcolor</span>(Blues2) <span class="fu">legend</span>(<span class="fu">pos</span>(<span class="dv">9</span>)) <span class="fu">legstyle</span>(<span class="dv">2</span>) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">"Employment Share Industry - 1950"</span>, <span class="fu">size</span>(medium)) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">osize</span>(<span class="fl">0.02</span> ..) <span class="fu">ocolor</span>(white ..) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clmethod</span>(custom) <span class="fu">clbreaks</span>(<span class="dv">0</span> (<span class="fl">0.2</span>) <span class="fl">0.8</span>) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ndfcolor</span>(gray) <span class="fu">ndocolor</span>(none ..) <span class="fu">ndsize</span>(<span class="fl">0.02</span> ..)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>spmap employment_share_industry using <span class="st">"nutscoord.dta"</span> <span class="cf">if</span> year <span class="sc">==</span> <span class="dv">1950</span>, <span class="fu">id</span>(_ID) <span class="fu">fcolor</span>(Blues2) <span class="fu">legstyle</span>(<span class="dv">2</span>) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">"Employment Share Industry - 1950"</span>, <span class="fu">size</span>(large)) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">osize</span>(<span class="fl">0.02</span> ..) <span class="fu">ocolor</span>(white ..) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clmethod</span>(custom) <span class="fu">clbreaks</span>(<span class="dv">0</span> (<span class="fl">0.2</span>) <span class="fl">0.8</span>) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">legend</span>(<span class="fu">pos</span>(<span class="dv">9</span>) <span class="fu">size</span>(medium) <span class="fu">rowgap</span>(<span class="fl">1.5</span>) <span class="fu">label</span>(<span class="dv">5</span> <span class="st">"60-80 %"</span>) <span class="fu">label</span>(<span class="dv">4</span> <span class="st">"40-60 %"</span>) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">label</span>(<span class="dv">3</span> <span class="st">"20-40 %"</span>) <span class="fu">label</span>(<span class="dv">2</span> <span class="st">"0-20 %"</span>) <span class="fu">label</span>(<span class="dv">1</span> <span class="st">"No data"</span>)) <span class="sc">/</span><span class="er">//</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ndfcolor</span>(gray) <span class="fu">ndocolor</span>(white ..) <span class="fu">ndsize</span>(<span class="fl">0.02</span> ..)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="column-page quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lab-1-resources/spmap_9.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Default legend</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lab-1-resources/spmap_10.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Breaks by 20 percent</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lab-1-resources/spmap_11.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">A well formatted legend</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p>More legend comparisons</p>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">If you have any questions, please feel free to <a href="mailto:jonathan.jayes@ekh.lu.se">contact me here <i class="fa-solid fa-paper-plane" aria-label="paper-plane"></i></a></div>
  </div>
</footer>



</body></html>